#!/bin/bash
BUNDLE=$HOME/.vim/bundle/
BUNDLE_LIST=$HOME/.vim/list_bundle
GIT=$(which git)

install ()
{
    # Check if urls file exists.
    [ -f "$BUNDLE_LIST" ] || return 0

    # Install all listed plugins.
    cd $BUNDLE
    for url in $(cat "$BUNDLE_LIST"); do
        echo "Cloning $url"
        $GIT clone "$url"
    done
}

update ()
{
    # Update all installed plugins.
    cd $BUNDLE
    for dir in *; do
        PLUGIN="$BUNDLE$dir"
        cd $PLUGIN
        echo "Updating $dir"

        if [ -d "$PLUGIN/.git" ]
        then
            $GIT stash;
            $GIT pull;
            $GIT stash pop;
        fi
        echo ""
    done
}

save()
{
    # Clear current bundle list file.
    if [ -f "$BUNDLE_LIST" ]
    then
        >| "$BUNDLE_LIST"
    fi

    # Update file with git repo urls.
    cd $BUNDLE
    for dir in *; do
        PLUGIN="$BUNDLE$dir"
        cd $PLUGIN

        if [ -d "$PLUGIN/.git" ]
        then
            echo `$GIT url` >> "$BUNDLE_LIST"
        fi
    done
}

main ()
{
    [ "$GIT" ] || return 0;

    [ -d $BUNDLE ] || mkdir -p $BUNDLE

    case "$1" in
        "") echo "Usage: ${0##*/} install|update|save"; exit;;
        "install") install; exit;;
        "update") update; exit;;
        "save") save; exit;;
    esac
}

main $@
